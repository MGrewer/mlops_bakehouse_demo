bundle:
  name: bakehouse_mlops_demo

variables:
  environment:
    description: Environment name (dev or prod)
  model_variant:
    description: Model variant (autolog or decorators)

resources:
  jobs:
    bakehouse_model_watcher:
      name: bakehouse_watcher_${var.model_variant}_${var.environment}
      schedule:
        quartz_cron_expression: "0 0 */6 * * ?"
        timezone_id: America/Detroit
      tasks:
        - task_key: monitoring
          notebook_task:
            notebook_path: ./06_monitoring.py
            base_parameters:
              environment: ${var.environment}
              model_variant: ${var.model_variant}

        - task_key: evaluation
          depends_on:
            - task_key: monitoring
          notebook_task:
            notebook_path: ./07_evaluation.py
            base_parameters:
              environment: ${var.environment}
              model_variant: ${var.model_variant}

        - task_key: retraining
          depends_on:
            - task_key: evaluation
          notebook_task:
            notebook_path: ./08_retraining.py
            base_parameters:
              environment: ${var.environment}
              model_variant: ${var.model_variant}

targets:
  dev:
    default: true
    variables:
      environment: dev
      model_variant: decorators
    workspace:
      root_path: /Workspace/Users/mitchell.grewer@databricks.com/mlops_bakehouse_demo/bakehouse_mlops_demo

  prod:
    variables:
      environment: prod
      model_variant: decorators
    workspace:
      root_path: /Workspace/Shared/bakehouse_mlops_published
